import React, { useContext, useState } from "react";
import "./Shop.scss";
import axios from "axios";
import { UserContext } from "../../contexts/UserContext";

const Shop = () => {
  const [selectedFile, setSelectedFile] = useState();
  const { token } = useContext(UserContext);

  const handleFileChange = (event) => {
    setSelectedFile(event.target.files[0]);
  };

  const handleUpload = () => {
    if (!selectedFile) {
      alert("Veuillez sélectionner un fichier avant de procéder à l'upload.");
      return;
    }

    const reader = new FileReader();

    reader.onload = (event) => {
      const fileData = event.target.result;
      const byteArray = new Uint8Array(fileData);
      const byteArrayAsArray = Array.from(byteArray);

      const requestData = {
        name: "Tee-shirt",
        description:
          "blablablzelr zeijrzijerijz eir ijzeirjze riojziejr iozjeroijz eiorj zoiejriozejr",
        price: 9.99,
        stockQuantity: 2,
        active: true,
        listPicture: [byteArrayAsArray],
        categorie: {
          id: "64cd019f54bf41039da4e3a9",
          name: "Coussin",
        },
      };

      const config = {
        headers: {
          Authorization: `Bearer ${token}`,
          "Content-Type": "application/json",
        },
      };

      axios
        .post("http://localhost:8080/api/product/add", requestData, config)
        .then((response) => {
          console.log("Upload successful!", response);
        })
        .catch((error) => {
          console.error("Error uploading file:", error);
        });
    };
    reader.readAsArrayBuffer(selectedFile);
  };

  return (
    <div>
      <h1>Image Upload Page</h1>
      <input type="file" onChange={handleFileChange} />
      <button onClick={handleUpload}>Upload</button>
    </div>
  );
};

export default Shop;
